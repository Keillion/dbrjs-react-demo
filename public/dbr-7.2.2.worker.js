'use strict';let dbrBWasmDebug,dbrEngineResourcePath,dbrVersion,dbrProductKeys,dbrBRuntimeKeys,dbrDomain,dbrBNewDevice=!1,dbrBUseFullFeature=!1,dbrUUID,dbrLicenseServer="https://dbrjsauth.dynamsoft.com/v2/",dbrPromiseGetLicense,dbrLicenseInfo,dbrPromisePostConsumption=Promise.resolve();
!function(p){"object"==typeof exports&&"undefined"!=typeof module?module.exports=p():"function"==typeof define&&define.amd?define([],p):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=p()}(function(){return function r(d,f,m){function h(a,u){if(!f[a]){if(!d[a]){var k="function"==typeof require&&require;if(!u&&k)return k(a,!0);if(q)return q(a,!0);u=Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u;}u=f[a]={exports:{}};
d[a][0].call(u.exports,function(f){return h(d[a][1][f]||f)},u,u.exports,r,d,f,m)}return f[a].exports}for(var q="function"==typeof require&&require,a=0;a<m.length;a++)h(m[a]);return h}({1:[function(d,f,m){(function(d){function h(){w=!0;for(var a,d,f=t.length;f;){d=t;t=[];for(a=-1;++a<f;)d[a]();f=t.length}w=!1}var q=d.MutationObserver||d.WebKitMutationObserver;if(q){var a=0;q=new q(h);var k=d.document.createTextNode("");q.observe(k,{characterData:!0});var m=function(){k.data=a=++a%2}}else if(d.setImmediate||
void 0===d.MessageChannel)m="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var a=d.document.createElement("script");a.onreadystatechange=function(){h();a.onreadystatechange=null;a.parentNode.removeChild(a);a=null};d.document.documentElement.appendChild(a)}:function(){setTimeout(h,0)};else{var r=new d.MessageChannel;r.port1.onmessage=h;m=function(){r.port2.postMessage(0)}}var w,t=[];f.exports=function(a){1!==t.push(a)||w||m()}}).call(this,"undefined"!=typeof global?
global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(d,f,m){function r(){}function h(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=G;this.queue=[];this.outcome=void 0;a!==r&&u(this,a)}function q(a,d,f){this.promise=a;"function"==typeof d&&(this.onFulfilled=d,this.callFulfilled=this.otherCallFulfilled);"function"==typeof f&&(this.onRejected=f,this.callRejected=this.otherCallRejected)}function a(a,d,f){w(function(){try{var k=
d(f)}catch(z){return t.reject(a,z)}k===a?t.reject(a,new TypeError("Cannot resolve promise with itself")):t.resolve(a,k)})}function k(a){var d=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof d)return function(){d.apply(a,arguments)}}function u(a,d){function f(d){h||(h=!0,t.reject(a,d))}function k(d){h||(h=!0,t.resolve(a,d))}var h=!1,m=K(function(){d(k,f)});"error"===m.status&&f(m.value)}function K(a,d){var f={};try{f.value=a(d),f.status="success"}catch(O){f.status="error",
f.value=O}return f}var w=d(1),t={},D=["REJECTED"],A=["FULFILLED"],G=["PENDING"];f.exports=h;h.prototype.catch=function(a){return this.then(null,a)};h.prototype.then=function(d,f){if("function"!=typeof d&&this.state===A||"function"!=typeof f&&this.state===D)return this;var k=new this.constructor(r);this.state!==G?a(k,this.state===A?d:f,this.outcome):this.queue.push(new q(k,d,f));return k};q.prototype.callFulfilled=function(a){t.resolve(this.promise,a)};q.prototype.otherCallFulfilled=function(d){a(this.promise,
this.onFulfilled,d)};q.prototype.callRejected=function(a){t.reject(this.promise,a)};q.prototype.otherCallRejected=function(d){a(this.promise,this.onRejected,d)};t.resolve=function(a,d){var f=K(k,d);if("error"===f.status)return t.reject(a,f.value);if(f=f.value)u(a,f);else{a.state=A;a.outcome=d;f=-1;for(var h=a.queue.length;++f<h;)a.queue[f].callFulfilled(d)}return a};t.reject=function(a,d){a.state=D;a.outcome=d;for(var f=-1,k=a.queue.length;++f<k;)a.queue[f].callRejected(d);return a};h.resolve=function(a){return a instanceof
this?a:t.resolve(new this(r),a)};h.reject=function(a){var d=new this(r);return t.reject(d,a)};h.all=function(a){function d(a,d){f.resolve(a).then(function(a){m[d]=a;++q!==k||h||(h=!0,t.resolve(w,m))},function(a){h||(h=!0,t.reject(w,a))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var k=a.length,h=!1;if(!k)return this.resolve([]);for(var m=Array(k),q=0,u=-1,w=new this(r);++u<k;)d(a[u],u);return w};h.race=function(a){function d(a){f.resolve(a).then(function(a){h||
(h=!0,t.resolve(q,a))},function(a){h||(h=!0,t.reject(q,a))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var k=a.length,h=!1;if(!k)return this.resolve([]);for(var m=-1,q=new this(r);++m<k;)d(a[m]);return q}},{1:1}],3:[function(d,f,m){f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};"function"!=typeof f.Promise&&(f.Promise=d(2))},{2:2}],4:[function(d,f,m){function r(b,
c){b=b||[];c=c||{};try{return new Blob(b,c)}catch(l){if("TypeError"!==l.name)throw l;for(var e=new ("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),a=0;a<b.length;a+=1)e.append(b[a]);return e.getBlob(c.type)}}function h(b,c){c&&b.then(function(b){c(null,b)},function(b){c(b)})}function q(b,c,e){"function"==typeof c&&b.then(c);"function"==typeof e&&b.catch(e)}function a(b){return"string"!=
typeof b&&(console.warn(b+" used as a key, but it is not a string."),b=String(b)),b}function k(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function u(b){return(new n(function(c){var e=b.transaction(Q,L),a=r([""]);e.objectStore(Q).put(a,"key");e.onabort=function(b){b.preventDefault();b.stopPropagation();c(!1)};e.oncomplete=function(){var b=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);c(e||!b||43<=parseInt(b[1],
10))}})).catch(function(){return!1})}function K(b){return"boolean"==typeof R?n.resolve(R):u(b).then(function(b){return R=b})}function w(b){b=x[b.name];var c={};c.promise=new n(function(b,a){c.resolve=b;c.reject=a});b.deferredOperations.push(c);b.dbReady?b.dbReady=b.dbReady.then(function(){return c.promise}):b.dbReady=c.promise}function t(b){if(b=x[b.name].deferredOperations.pop())return b.resolve(),b.promise}function D(b,c){if(b=x[b.name].deferredOperations.pop())return b.reject(c),b.promise}function A(b,
c){return new n(function(e,a){if(x[b.name]=x[b.name]||Z(),b.db){if(!c)return e(b.db);w(b);b.db.close()}var v=[b.name];c&&v.push(b.version);var g=H.open.apply(H,v);c&&(g.onupgradeneeded=function(c){var e=g.result;try{e.createObjectStore(b.storeName),1>=c.oldVersion&&e.createObjectStore(Q)}catch(y){if("ConstraintError"!==y.name)throw y;console.warn('The database "'+b.name+'" has been upgraded from version '+c.oldVersion+" to version "+c.newVersion+', but the storage "'+b.storeName+'" already exists.')}});
g.onerror=function(b){b.preventDefault();a(g.error)};g.onsuccess=function(){e(g.result);t(b)}})}function G(b,c){if(!b.db)return!0;var e=!b.db.objectStoreNames.contains(b.storeName),a=b.version>b.db.version;return(b.version<b.db.version&&(b.version!==c&&console.warn('The database "'+b.name+"\" can't be downgraded from version "+b.db.version+" to version "+b.version+"."),b.version=b.db.version),a||e)?(e&&(c=b.db.version+1,c>b.version&&(b.version=c)),!0):!1}function ka(b){return new n(function(c,e){var a=
new FileReader;a.onerror=e;a.onloadend=function(e){e=btoa(e.target.result||"");c({__local_forage_encoded_blob:!0,data:e,type:b.type})};a.readAsBinaryString(b)})}function X(b){for(var c=atob(b.data),e=c.length,a=new ArrayBuffer(e),l=new Uint8Array(a),g=0;g<e;g++)l[g]=c.charCodeAt(g);return r([a],{type:b.type})}function la(b){var c=this,e=c._initReady().then(function(){var b=x[c._dbInfo.name];if(b&&b.dbReady)return b.dbReady});return q(e,b,b),e}function O(b){w(b);for(var c=x[b.name],e=c.forages,a=0;a<
e.length;a++){var l=e[a];l._dbInfo.db&&(l._dbInfo.db.close(),l._dbInfo.db=null)}return b.db=null,A(b,!1).then(function(c){return b.db=c,G(b)?A(b,!0):c}).then(function(a){b.db=c.db=a;for(var g=0;g<e.length;g++)e[g]._dbInfo.db=a}).catch(function(c){throw D(b,c),c;})}function z(b,c,e,a){void 0===a&&(a=1);try{var v=b.db.transaction(b.storeName,c);e(null,v)}catch(g){if(0<a&&(!b.db||"InvalidStateError"===g.name||"NotFoundError"===g.name))return n.resolve().then(function(){if(!b.db||"NotFoundError"===g.name&&
!b.db.objectStoreNames.contains(b.storeName)&&b.version<=b.db.version)return b.db&&(b.version=b.db.version+1),A(b,!0)}).then(function(){return O(b).then(function(){z(b,c,e,a-1)})}).catch(e);e(g)}}function Z(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Y(b){var c=.75*b.length;var e=b.length,a=0;"="===b[b.length-1]&&(c--,"="===b[b.length-2]&&c--);var l=new ArrayBuffer(c),g=new Uint8Array(l);for(c=0;c<e;c+=4){var d=C.indexOf(b[c]);var da=C.indexOf(b[c+1]);var y=C.indexOf(b[c+
2]);var f=C.indexOf(b[c+3]);g[a++]=d<<2|da>>4;g[a++]=(15&da)<<4|y>>2;g[a++]=(3&y)<<6|63&f}return l}function P(b){var c=new Uint8Array(b),e="";for(b=0;b<c.length;b+=3)e+=C[c[b]>>2],e+=C[(3&c[b])<<4|c[b+1]>>4],e+=C[(15&c[b+1])<<2|c[b+2]>>6],e+=C[63&c[b+2]];return 2==c.length%3?e=e.substring(0,e.length-1)+"=":1==c.length%3&&(e=e.substring(0,e.length-2)+"=="),e}function ba(b,c,e,a){b.executeSql("CREATE TABLE IF NOT EXISTS "+c.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],e,a)}function B(b,
c,e,a,l,g){b.executeSql(e,a,l,function(b,v){v.code===v.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[c.storeName],function(b,d){d.rows.length?g(b,v):ba(b,c,function(){b.executeSql(e,a,l,g)},g)},g):g(b,v)},g)}function aa(b,c,e,v){var l=this;b=a(b);var g=new n(function(a,g){l.ready().then(function(){void 0===c&&(c=null);var d=c,f=l._dbInfo;f.serializer.serialize(c,function(c,y){y?g(y):f.db.transaction(function(e){B(e,f,"INSERT OR REPLACE INTO "+f.storeName+
" (key, value) VALUES (?, ?)",[b,c],function(){a(d)},function(b,c){g(c)})},function(c){if(c.code===c.QUOTA_ERR){if(0<v)return void a(aa.apply(l,[b,d,e,v-1]));g(c)}})})}).catch(g)});return h(g,e),g}function ma(b){return new n(function(c,e){b.transaction(function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,a){e=[];for(var g=0;g<a.rows.length;g++)e.push(a.rows.item(g).name);c({db:b,storeNames:e})},function(b,c){e(c)})},function(b){e(b)})})}
function ea(b,c){var e=b.name+"/";return b.storeName!==c.storeName&&(e+=b.storeName+"/"),e}function na(b,c){b[c]=function(){var e=arguments;return b.ready().then(function(){return b[c].apply(b,e)})}}function U(){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var e in c)c.hasOwnProperty(e)&&(fa(c[e])?arguments[0][e]=c[e].slice():arguments[0][e]=c[e])}return arguments[0]}var oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&
"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},H=function(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}();"undefined"==typeof Promise&&d(3);var n=Promise,Q="local-forage-detect-blob-support",R=void 0,x={},pa=Object.prototype.toString,
L="readwrite";d={_driver:"asyncStorage",_initStorage:function(b){function c(){return n.resolve()}var e=this,a={db:null};if(b)for(var l in b)a[l]=b[l];var g=x[a.name];g||(g=Z(),x[a.name]=g);g.forages.push(e);e._initReady||(e._initReady=e.ready,e.ready=la);b=[];for(l=0;l<g.forages.length;l++){var d=g.forages[l];d!==e&&b.push(d._initReady().catch(c))}var f=g.forages.slice(0);return n.all(b).then(function(){return a.db=g.db,A(a,!1)}).then(function(b){return a.db=b,G(a,e._defaultConfig.version)?A(a,!0):
b}).then(function(b){a.db=g.db=b;e._dbInfo=a;for(b=0;b<f.length;b++){var c=f[b];c!==e&&(c._dbInfo.db=a.db,c._dbInfo.version=a.version)}})},_support:function(){try{if(!H)return!1;var b="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),c="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!b||c)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),
iterate:function(b,c){var e=this,a=new n(function(c,a){e.ready().then(function(){z(e._dbInfo,"readonly",function(g,l){if(g)return a(g);try{var d=l.objectStore(e._dbInfo.storeName).openCursor(),v=1;d.onsuccess=function(){var e=d.result;if(e){var a=e.value;a&&a.__local_forage_encoded_blob&&(a=X(a));a=b(a,e.key,v++);void 0!==a?c(a):e.continue()}else c()};d.onerror=function(){a(d.error)}}catch(S){a(S)}})}).catch(a)});return h(a,c),a},getItem:function(b,c){var e=this;b=a(b);var d=new n(function(c,a){e.ready().then(function(){z(e._dbInfo,
"readonly",function(g,d){if(g)return a(g);try{var l=d.objectStore(e._dbInfo.storeName).get(b);l.onsuccess=function(){var b=l.result;void 0===b&&(b=null);b&&b.__local_forage_encoded_blob&&(b=X(b));c(b)};l.onerror=function(){a(l.error)}}catch(I){a(I)}})}).catch(a)});return h(d,c),d},setItem:function(b,c,e){var d=this;b=a(b);var l=new n(function(a,e){var g;d.ready().then(function(){return g=d._dbInfo,"[object Blob]"===pa.call(c)?K(g.db).then(function(b){return b?c:ka(c)}):c}).then(function(c){z(d._dbInfo,
L,function(g,l){if(g)return e(g);try{var v=l.objectStore(d._dbInfo.storeName);null===c&&(c=void 0);var f=v.put(c,b);l.oncomplete=function(){void 0===c&&(c=null);a(c)};l.onabort=l.onerror=function(){e(f.error?f.error:f.transaction.error)}}catch(T){e(T)}})}).catch(e)});return h(l,e),l},removeItem:function(b,c){var e=this;b=a(b);var d=new n(function(c,a){e.ready().then(function(){z(e._dbInfo,L,function(g,d){if(g)return a(g);try{var l=d.objectStore(e._dbInfo.storeName).delete(b);d.oncomplete=function(){c()};
d.onerror=function(){a(l.error)};d.onabort=function(){a(l.error?l.error:l.transaction.error)}}catch(I){a(I)}})}).catch(a)});return h(d,c),d},clear:function(b){var c=this,a=new n(function(b,a){c.ready().then(function(){z(c._dbInfo,L,function(e,d){if(e)return a(e);try{var g=d.objectStore(c._dbInfo.storeName).clear();d.oncomplete=function(){b()};d.onabort=d.onerror=function(){a(g.error?g.error:g.transaction.error)}}catch(y){a(y)}})}).catch(a)});return h(a,b),a},length:function(b){var c=this,a=new n(function(b,
a){c.ready().then(function(){z(c._dbInfo,"readonly",function(e,d){if(e)return a(e);try{var g=d.objectStore(c._dbInfo.storeName).count();g.onsuccess=function(){b(g.result)};g.onerror=function(){a(g.error)}}catch(y){a(y)}})}).catch(a)});return h(a,b),a},key:function(b,c){var a=this,d=new n(function(c,e){if(0>b)return void c(null);a.ready().then(function(){z(a._dbInfo,"readonly",function(d,g){if(d)return e(d);try{var l=!1,f=g.objectStore(a._dbInfo.storeName).openCursor();f.onsuccess=function(){var a=
f.result;if(!a)return void c(null);0===b?c(a.key):l?c(a.key):(l=!0,a.advance(b))};f.onerror=function(){e(f.error)}}catch(S){e(S)}})}).catch(e)});return h(d,c),d},keys:function(b){var c=this,a=new n(function(b,a){c.ready().then(function(){z(c._dbInfo,"readonly",function(e,d){if(e)return a(e);try{var g=d.objectStore(c._dbInfo.storeName).openCursor(),l=[];g.onsuccess=function(){var a=g.result;if(!a)return void b(l);l.push(a.key);a.continue()};g.onerror=function(){a(g.error)}}catch(I){a(I)}})}).catch(a)});
return h(a,b),a},dropInstance:function(b,a){a=k.apply(this,arguments);var c=this.config();b="function"!=typeof b&&b||{};b.name||(b.name=b.name||c.name,b.storeName=b.storeName||c.storeName);b.name?(c=b.name===c.name&&this._dbInfo.db?n.resolve(this._dbInfo.db):A(b,!1).then(function(a){var c=x[b.name],e=c.forages;c.db=a;for(c=0;c<e.length;c++)e[c]._dbInfo.db=a;return a}),c=b.storeName?c.then(function(a){if(a.objectStoreNames.contains(b.storeName)){var c=a.version+1;w(b);var e=x[b.name],d=e.forages;a.close();
for(a=0;a<d.length;a++){var f=d[a];f._dbInfo.db=null;f._dbInfo.version=c}return(new n(function(a,e){var d=H.open(b.name,c);d.onerror=function(b){d.result.close();e(b)};d.onupgradeneeded=function(){d.result.deleteObjectStore(b.storeName)};d.onsuccess=function(){var b=d.result;b.close();a(b)}})).then(function(b){e.db=b;for(var a=0;a<d.length;a++){var c=d[a];c._dbInfo.db=b;t(c._dbInfo)}}).catch(function(a){throw(D(b,a)||n.resolve()).catch(function(){}),a;})}}):c.then(function(a){w(b);var c=x[b.name],
e=c.forages;a.close();for(a=0;a<e.length;a++)e[a]._dbInfo.db=null;return(new n(function(a,c){var e=H.deleteDatabase(b.name);e.onerror=e.onblocked=function(b){var a=e.result;a&&a.close();c(b)};e.onsuccess=function(){var b=e.result;b&&b.close();a(b)}})).then(function(b){c.db=b;for(b=0;b<e.length;b++)t(e[b]._dbInfo)}).catch(function(a){throw(D(b,a)||n.resolve()).catch(function(){}),a;})})):c=n.reject("Invalid arguments");return h(c,a),c}};var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
ha=/^~~local_forage_type~([^~]+)~/,ia=Object.prototype.toString,V={serialize:function(b,a){var c="";if(b&&(c=ia.call(b)),b&&("[object ArrayBuffer]"===c||b.buffer&&"[object ArrayBuffer]"===ia.call(b.buffer))){var d,f="__lfsc__:";b instanceof ArrayBuffer?(d=b,f+="arbf"):(d=b.buffer,"[object Int8Array]"===c?f+="si08":"[object Uint8Array]"===c?f+="ui08":"[object Uint8ClampedArray]"===c?f+="uic8":"[object Int16Array]"===c?f+="si16":"[object Uint16Array]"===c?f+="ur16":"[object Int32Array]"===c?f+="si32":
"[object Uint32Array]"===c?f+="ui32":"[object Float32Array]"===c?f+="fl32":"[object Float64Array]"===c?f+="fl64":a(Error("Failed to get type for BinaryArray")));a(f+P(d))}else if("[object Blob]"===c)c=new FileReader,c.onload=function(){var c="~~local_forage_type~"+b.type+"~"+P(this.result);a("__lfsc__:blob"+c)},c.readAsArrayBuffer(b);else try{a(JSON.stringify(b))}catch(g){console.error("Couldn't convert value into a JSON string: ",b),a(null,g)}},deserialize:function(b){if("__lfsc__:"!==b.substring(0,
9))return JSON.parse(b);var a=b.substring(13);b=b.substring(9,13);if("blob"===b&&ha.test(a)){var e=a.match(ha);var d=e[1];a=a.substring(e[0].length)}a=Y(a);switch(b){case "arbf":return a;case "blob":return r([a],{type:d});case "si08":return new Int8Array(a);case "ui08":return new Uint8Array(a);case "uic8":return new Uint8ClampedArray(a);case "si16":return new Int16Array(a);case "ur16":return new Uint16Array(a);case "si32":return new Int32Array(a);case "ui32":return new Uint32Array(a);case "fl32":return new Float32Array(a);
case "fl64":return new Float64Array(a);default:throw Error("Unkown type: "+b);}},stringToBuffer:Y,bufferToString:P};m={_driver:"webSQLStorage",_initStorage:function(b){var a=this,e={db:null};if(b)for(var d in b)e[d]="string"!=typeof b[d]?b[d].toString():b[d];b=new n(function(b,c){try{e.db=openDatabase(e.name,String(e.version),e.description,e.size)}catch(ca){return c(ca)}e.db.transaction(function(d){ba(d,e,function(){a._dbInfo=e;b()},function(b,a){c(a)})},c)});return e.serializer=V,b},_support:"function"==
typeof openDatabase,iterate:function(b,a){var c=this,d=new n(function(a,e){c.ready().then(function(){var d=c._dbInfo;d.db.transaction(function(c){B(c,d,"SELECT * FROM "+d.storeName,[],function(c,e){c=e.rows;e=c.length;for(var g=0;g<e;g++){var f=c.item(g),l=f.value;if(l&&(l=d.serializer.deserialize(l)),void 0!==(l=b(l,f.key,g+1)))return void a(l)}a()},function(b,a){e(a)})})}).catch(e)});return h(d,a),d},getItem:function(b,c){var e=this;b=a(b);var d=new n(function(a,c){e.ready().then(function(){var d=
e._dbInfo;d.db.transaction(function(e){B(e,d,"SELECT * FROM "+d.storeName+" WHERE key = ? LIMIT 1",[b],function(b,c){(b=c.rows.length?c.rows.item(0).value:null)&&(b=d.serializer.deserialize(b));a(b)},function(b,a){c(a)})})}).catch(c)});return h(d,c),d},setItem:function(b,a,e){return aa.apply(this,[b,a,e,1])},removeItem:function(b,c){var e=this;b=a(b);var d=new n(function(a,c){e.ready().then(function(){var d=e._dbInfo;d.db.transaction(function(e){B(e,d,"DELETE FROM "+d.storeName+" WHERE key = ?",[b],
function(){a()},function(b,a){c(a)})})}).catch(c)});return h(d,c),d},clear:function(b){var a=this,e=new n(function(b,c){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"DELETE FROM "+e.storeName,[],function(){b()},function(b,a){c(a)})})}).catch(c)});return h(e,b),e},length:function(b){var a=this,e=new n(function(b,c){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"SELECT COUNT(key) as c FROM "+e.storeName,[],function(a,c){a=c.rows.item(0).c;
b(a)},function(b,a){c(a)})})}).catch(c)});return h(e,b),e},key:function(b,a){var c=this,d=new n(function(a,e){c.ready().then(function(){var d=c._dbInfo;d.db.transaction(function(c){B(c,d,"SELECT key FROM "+d.storeName+" WHERE id = ? LIMIT 1",[b+1],function(b,c){b=c.rows.length?c.rows.item(0).key:null;a(b)},function(b,a){e(a)})})}).catch(e)});return h(d,a),d},keys:function(b){var a=this,e=new n(function(b,c){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(a){B(a,e,"SELECT key FROM "+
e.storeName,[],function(a,c){a=[];for(var e=0;e<c.rows.length;e++)a.push(c.rows.item(e).key);b(a)},function(b,a){c(a)})})}).catch(c)});return h(e,b),e},dropInstance:function(b,a){a=k.apply(this,arguments);var c=this.config();b="function"!=typeof b&&b||{};b.name||(b.name=b.name||c.name,b.storeName=b.storeName||c.storeName);var d,f=this;return d=b.name?(new n(function(a){var e=b.name===c.name?f._dbInfo.db:openDatabase(b.name,"","",0);a(b.storeName?{db:e,storeNames:[b.storeName]}:ma(e))})).then(function(b){return new n(function(a,
c){b.db.transaction(function(e){function d(b){return new n(function(a,c){e.executeSql("DROP TABLE IF EXISTS "+b,[],function(){a()},function(b,a){c(a)})})}for(var f=[],g=0,l=b.storeNames.length;g<l;g++)f.push(d(b.storeNames[g]));n.all(f).then(function(){a()}).catch(function(b){c(b)})},function(b){c(b)})})}):n.reject("Invalid arguments"),h(d,a),d}};try{var E="undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(b){E=!1}var qa=function(b,a){for(var c=b.length,d=0;d<
c;){var f=b[d],g=a;if(f===g||"number"==typeof f&&"number"==typeof g&&isNaN(f)&&isNaN(g))return!0;d++}return!1},fa=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},J={},ja={},F={INDEXEDDB:d,WEBSQL:m,LOCALSTORAGE:{_driver:"localStorageWrapper",_initStorage:function(b){var a={};if(b)for(var e in b)a[e]=b[e];a.keyPrefix=ea(b,this._defaultConfig);try{var d=(localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1)}catch(l){d=
!0}return!d||0<localStorage.length?(this._dbInfo=a,a.serializer=V,n.resolve()):n.reject()},_support:E,iterate:function(b,a){var c=this,d=c.ready().then(function(){for(var a=c._dbInfo,e=a.keyPrefix,d=e.length,f=localStorage.length,k=1,h=0;h<f;h++){var m=localStorage.key(h);if(0===m.indexOf(e)){var q=localStorage.getItem(m);if(q&&(q=a.serializer.deserialize(q)),void 0!==(q=b(q,m.substring(d),k++)))return q}}});return h(d,a),d},getItem:function(b,c){var e=this;b=a(b);var d=e.ready().then(function(){var a=
e._dbInfo,c=localStorage.getItem(a.keyPrefix+b);return c&&(c=a.serializer.deserialize(c)),c});return h(d,c),d},setItem:function(b,c,e){var d=this;b=a(b);var f=d.ready().then(function(){void 0===c&&(c=null);var a=c;return new n(function(e,f){var g=d._dbInfo;g.serializer.serialize(c,function(c,d){if(d)f(d);else try{localStorage.setItem(g.keyPrefix+b,c),e(a)}catch(M){"QuotaExceededError"!==M.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==M.name||f(M),f(M)}})})});return h(f,e),f},removeItem:function(b,c){var e=
this;b=a(b);var d=e.ready().then(function(){localStorage.removeItem(e._dbInfo.keyPrefix+b)});return h(d,c),d},clear:function(a){var b=this,e=b.ready().then(function(){for(var a=b._dbInfo.keyPrefix,c=localStorage.length-1;0<=c;c--){var e=localStorage.key(c);0===e.indexOf(a)&&localStorage.removeItem(e)}});return h(e,a),e},length:function(a){var b=this.keys().then(function(a){return a.length});return h(b,a),b},key:function(a,c){var b=this,d=b.ready().then(function(){var c=b._dbInfo;try{var e=localStorage.key(a)}catch(ca){e=
null}return e&&(e=e.substring(c.keyPrefix.length)),e});return h(d,c),d},keys:function(a){var b=this,e=b.ready().then(function(){for(var a=b._dbInfo,c=localStorage.length,e=[],d=0;d<c;d++){var f=localStorage.key(d);0===f.indexOf(a.keyPrefix)&&e.push(f.substring(a.keyPrefix.length))}return e});return h(e,a),e},dropInstance:function(a,c){if(c=k.apply(this,arguments),a="function"!=typeof a&&a||{},!a.name){var b=this.config();a.name=a.name||b.name;a.storeName=a.storeName||b.storeName}var d,f=this;return d=
a.name?(new n(function(b){b(a.storeName?ea(a,f._defaultConfig):a.name+"/")})).then(function(a){for(var b=localStorage.length-1;0<=b;b--){var c=localStorage.key(b);0===c.indexOf(a)&&localStorage.removeItem(c)}}):n.reject("Invalid arguments"),h(d,c),d}}};E=[F.INDEXEDDB._driver,F.WEBSQL._driver,F.LOCALSTORAGE._driver];var N=["dropInstance"],W="clear getItem iterate key keys length removeItem setItem".split(" ").concat(N),ra={description:"",driver:E.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",
version:1};E=new (function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");for(var c in F)if(F.hasOwnProperty(c)){var d=F[c],f=d._driver;this[c]=f;J[f]||this.defineDriver(d)}this._defaultConfig=U({},ra);this._config=U({},this._defaultConfig,b);this._initDriver=this._driverSet=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(a){if("object"===
(void 0===a?"undefined":oa(a))){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var b in a){if("storeName"===b&&(a[b]=a[b].replace(/\W/g,"_")),"version"===b&&"number"!=typeof a[b])return Error("Database version must be a number.");this._config[b]=a[b]}return!("driver"in a&&a.driver)||this.setDriver(this._config.driver)}return"string"==typeof a?this._config[a]:this._config},a.prototype.defineDriver=function(a,b,d){var c=new n(function(b,c){try{var d=a._driver,
e=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver)return void c(e);for(var f=W.concat("_initStorage"),g=0,k=f.length;g<k;g++){var l=f[g];if((!qa(N,l)||a[l])&&"function"!=typeof a[l])return void c(e)}(function(){for(var b=function(a){return function(){var b=n.reject(Error("Method "+a+" is not implemented by the current driver"));return h(b,arguments[arguments.length-1]),b}},c=0,d=N.length;c<d;c++){var e=N[c];a[e]||(a[e]=b(e))}})();e=function(c){J[d]&&
console.info("Redefining LocalForage driver: "+d);J[d]=a;ja[d]=c;b()};"_support"in a?a._support&&"function"==typeof a._support?a._support().then(e,c):e(!!a._support):e(!0)}catch(T){c(T)}});return q(c,b,d),c},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(a,b,d){a=J[a]?n.resolve(J[a]):n.reject(Error("Driver not found."));return q(a,b,d),a},a.prototype.getSerializer=function(a){var b=n.resolve(V);return q(b,a),b},a.prototype.ready=function(a){var b=this,c=b._driverSet.then(function(){return null===
b._ready&&(b._ready=b._initDriver()),b._ready});return q(c,a,a),c},a.prototype.setDriver=function(a,b,d){function c(){k._config.driver=k.driver()}function e(a){return k._extend(a),c(),k._ready=k._initStorage(k._config),k._ready}function f(a){return function(){function b(){for(;d<a.length;){var f=a[d];return d++,k._dbInfo=null,k._ready=null,k.getDriver(f).then(e).catch(b)}c();return k._driverSet=n.reject(Error("No available storage method found.")),k._driverSet}var d=0;return b()}}var k=this;fa(a)||
(a=[a]);var h=this._getSupportedDrivers(a);return this._driverSet=(null!==this._driverSet?this._driverSet.catch(function(){return n.resolve()}):n.resolve()).then(function(){var a=h[0];return k._dbInfo=null,k._ready=null,k.getDriver(a).then(function(a){k._driver=a._driver;c();k._wrapLibraryMethodsWithReady();k._initDriver=f(h)})}).catch(function(){c();return k._driverSet=n.reject(Error("No available storage method found.")),k._driverSet}),q(this._driverSet,b,d),this._driverSet},a.prototype.supports=
function(a){return!!ja[a]},a.prototype._extend=function(a){U(this,a)},a.prototype._getSupportedDrivers=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var f=a[c];this.supports(f)&&b.push(f)}return b},a.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,b=W.length;a<b;a++)na(this,W[a])},a.prototype.createInstance=function(b){return new a(b)},a}());f.exports=E},{3:3}]},{},[4])(4)});
let dbrStoreConsumption,dbrStoreLicenseInfo,dbrBSendSmallRecordsForDebug,dbrSessionDuration,dbrNextPostConsumptionTime=-Infinity,dbrNextTaskId=0,dbrTaskCallbackMap=new Map,dbrAESGCMKey,dbrFuncGenAESGCMKey=()=>self.crypto.subtle.importKey("raw",new Uint8Array([80,88,27,82,145,164,199,211,187,87,89,128,150,44,190,213,99,181,118,158,215,103,76,117,29,83,122,137,5,180,157,114]),"AES-GCM",!0,["encrypt","decrypt"]),dbrFuncDecryptAndAtob=async p=>{if(self.crypto){var d=atob(p),f=new Uint8Array(d.length);
for(let m=0;m<d.length;++m)f[m]=d.charCodeAt(m);d=f.subarray(0,12);f=f.subarray(d.length);dbrAESGCMKey||(dbrAESGCMKey=await dbrFuncGenAESGCMKey());f=await self.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:128},dbrAESGCMKey,f);return String.fromCharCode.apply(null,new Uint8Array(f))}return await new Promise((d,f)=>{let h=dbrNextTaskId++;dbrTaskCallbackMap.set(h,h=>{if(h.success)return dbrBWasmDebug&&console.log(h.txt),d(h.txt);{let a=Error(h.message);a.stack+="\n"+h.stack;return f(a)}});postMessage({type:"taskd",
taskID:h,txt:p})})},dbrFuncEncryptAndBtoa=async p=>{if(self.crypto){var d=new Uint8Array(p.length);for(var f=0;f<p.length;++f)d[f]=p.charCodeAt(f);f=self.crypto.getRandomValues(new Uint8Array(12));dbrAESGCMKey||(dbrAESGCMKey=await dbrFuncGenAESGCMKey());d=await self.crypto.subtle.encrypt({name:"AES-GCM",iv:f,tagLength:128},dbrAESGCMKey,d);d=new Uint8Array(d);let m=new Uint8Array(f.length+d.length);m.set(f);m.set(d,f.length);return btoa(String.fromCharCode.apply(null,m))}return await new Promise((d,
f)=>{let h=dbrNextTaskId++;dbrTaskCallbackMap.set(h,h=>{if(h.success)return dbrBWasmDebug&&console.log(h.txt),d(h.txt);{let a=Error(h.message);a.stack+="\n"+h.stack;return f(a)}});postMessage({type:"taske",taskID:h,txt:p})})};
var Module={locateFile:function(p){return"libDynamsoftBarcodeReader.wasm"==p?dbrEngineResourcePath+"dbr-"+dbrVersion+(dbrBUseFullFeature?".full":"")+".wasm":dbrEngineResourcePath+p},printErr:console.error,onRuntimeInitialized:async function(){postMessage({type:"log",message:"wasm initialized"});let p={productKeys:dbrProductKeys,domain:dbrDomain};dbrBWasmDebug&&(p.bDebug=!0);if(dbrBRuntimeKeys){await dbrPromiseGetLicense;let d=dbrLicenseInfo;if(d instanceof Error){postMessage({type:"load",success:!1,
message:d.message,stack:d.stack});setTimeout(()=>{throw d;},0);return}if(!d.productKeys){postMessage({type:"load",success:!1,message:d.message,stack:""});return}dbrSessionDuration=1E3*d.sessionDuration;p.runtimeKeys=dbrProductKeys;p.productKeys=d.productKeys;p.consumeType=d.consumeType;p.urlGetLicense="";p.aryUrlPostConsume=p.sm_aryUrlPostConsume=[];p.bNewDevice=dbrBNewDevice;p.uuid=dbrUUID;p.initTime=Date.now().toString();sendConsume();setInterval(sendConsume,dbrSessionDuration)}Module.BarcodeReaderWasm.init(JSON.stringify(p));
postMessage({type:"load",success:!0,version:Module.BarcodeReaderWasm.getVersion()})}};let DBR_MapInstances=new Map,nextInstanceID=0;
onmessage=async function(p){var d=p.data,f=d.id,m=d.instanceID;const r=d.body;switch(d.type){case "loadWasm":dbrBWasmDebug=d.bWasmDebug;dbrEngineResourcePath=d.engineResourcePath;dbrVersion=d.version;dbrProductKeys=d.productKeys;dbrDomain=d.domain;dbrBUseFullFeature=d.bUseFullFeature;dbrUUID=d.uuid;dbrLicenseServer=d.licenseServer?d.licenseServer:dbrLicenseServer;dbrBSendSmallRecordsForDebug=d.bSendSmallRecordsForDebug;importScripts(dbrEngineResourcePath+"dbr-"+dbrVersion+(dbrBUseFullFeature?".full":
"")+".wasm.js");if(dbrBRuntimeKeys=8==dbrProductKeys.length)dbrStoreLicenseInfo=await localforage.createInstance({name:"dbrjsLicenseInfo"}),dbrStoreConsumption=await localforage.createInstance({name:"dbrjs"+dbrProductKeys+"unsV2"}),dbrBNewDevice=!await dbrStoreLicenseInfo.getItem(dbrProductKeys+"old"),dbrPromiseGetLicense=(async()=>{let a;var d=await dbrStoreLicenseInfo.getItem(dbrProductKeys);d&&([d,a]=d,Date.now()>d&&(await dbrStoreLicenseInfo.removeItem(dbrProductKeys),a=null));try{await Promise.race([fetch(dbrLicenseServer+
"api/verification/"+dbrProductKeys).then(a=>{if(a.ok)return a.text();throw Error("Network Error. Can't get license.");}).then(d=>{a=d;return dbrStoreLicenseInfo.setItem(dbrProductKeys,[Date.now()+6048E5,a])}),new Promise((d,f)=>{setTimeout(()=>f(Error("Network Error. Request timeout.")),a?3E3:15E3)})])}catch(u){if(dbrBWasmDebug&&console.error(u),null==a){dbrLicenseInfo=u;return}}dbrLicenseInfo=await dbrFuncDecryptAndAtob(a).then(a=>JSON.parse(a)).catch(()=>Error("Parse Error. Can't get valid license."))})().then(()=>
{console.log("get license info immmediately: ",dbrLicenseInfo)});break;case "createInstance":m=nextInstanceID++;try{let a=new Module.BarcodeReaderWasm(d.bScanner,m);DBR_MapInstances.set(m,a);let f=JSON.parse(a.getRuntimeSettings());d.bScanner?(f.localizationModes=[2,0,0,0,0,0,0,0],f.deblurLevel=2):f.expectedBarcodesCount=512;dbrBUseFullFeature||(f.barcodeFormatIds=234882047);a.updateRuntimeSettings(JSON.stringify(f))}catch(a){handleErr(a,f);break}postMessage({type:"task",id:f,body:{success:!0,instanceID:m}});
break;case "destroy":try{DBR_MapInstances.get(m).delete(),DBR_MapInstances.delete(m)}catch(a){handleErr(a,f);break}postMessage({type:"task",id:f,body:{success:!0}});break;case "decodeBuffer":{let a;try{a=JSON.parse(DBR_MapInstances.get(m).decodeBuffer(r.buffer,r.width,r.height,r.stride,r.format))}catch(k){handleErr(k,f);break}postMessage({type:"task",id:f,body:{success:!0,decodeReturn:a}});break}case "getRuntimeSettings":{let a;try{a=DBR_MapInstances.get(m).getRuntimeSettings()}catch(k){handleErr(k,
f);break}postMessage({type:"task",id:f,body:{success:!0,results:a}});break}case "updateRuntimeSettings":{let a;try{a=JSON.parse(DBR_MapInstances.get(m).updateRuntimeSettings(r.settings))}catch(k){handleErr(k,f);break}postMessage({type:"task",id:f,body:{success:!0,updateReturn:a}});break}case "resetRuntimeSettings":try{DBR_MapInstances.get(m).resetRuntimeSettings()}catch(a){handleErr(p,f);break}this.postMessage({type:"task",id:f,body:{success:!0}});break;case "outputSettingsToString":{let a;try{a=
DBR_MapInstances.get(m).outputSettingsToString()}catch(k){handleErr(k,f);break}postMessage({type:"task",id:f,body:{success:!0,results:a}});break}case "initRuntimeSettingsWithString":{let a;try{a=JSON.parse(DBR_MapInstances.get(m).initRuntimeSettingsWithString(r.settings))}catch(k){handleErr(k,f);break}postMessage({type:"task",id:f,body:{success:!0,initReturn:a}});break}case "getIntermediateResults":{let a=null;try{var h=DBR_MapInstances.get(m).getIntermediateResults(),q=JSON.parse(h,(d,f)=>"bytes"===
d&&"ptr"in f&&"length"in f?a=Module.BarcodeReaderWasm.getBytes(f.ptr,f.length):f);DBR_MapInstances.get(m).freeIntermediateResults()}catch(k){handleErr(k,f);break}this.postMessage({type:"task",id:f,body:{success:!0,results:q}});break}case "setModeArgument":{let a;try{a=JSON.parse(DBR_MapInstances.get(m).setModeArgument(r.modeName,r.index,r.argumentName,r.argumentValue))}catch(k){handleErr(k,f);break}this.postMessage({type:"task",id:f,body:{success:!0,setReturn:a}});break}case "updateScanSettings":try{let a=
DBR_MapInstances.get(m),d=r.settings;a.duplicateForgetTime=d.duplicateForgetTime;a.oneDRememberFrameCount=d.oneDRememberFrameCount;a.oneDTrustFrameCount=d.oneDTrustFrameCount;d.frameFilter?a.setFrameFilter(JSON.stringify(d.frameFilter)):a.setFrameFilter("")}catch(a){handleErr(a,f);break}this.postMessage({type:"task",id:f,body:{success:!0}});break;case "getScanSettings":d={};try{let a=DBR_MapInstances.get(m);d.duplicateForgetTime=a.duplicateForgetTime;d.oneDRememberFrameCount=a.oneDRememberFrameCount;
d.oneDTrustFrameCount=a.oneDTrustFrameCount;let f=a.getFrameFilter();f&&(d.frameFilter=JSON.parse(f))}catch(a){handleErr(a,f);break}this.postMessage({type:"task",id:f,body:{success:!0,results:d}});break;case "task":f=d.id;d=d.body;try{dbrTaskCallbackMap.get(f)(d),dbrTaskCallbackMap.delete(f)}catch(a){throw dbrTaskCallbackMap.delete(f),a;}break;default:console.warn("Unmatched task: ",p)}};
let handleErr=(p,d)=>{postMessage({type:"task",id:d,body:{success:!1,message:p.message,stack:p.stack}});setTimeout(()=>{throw p;},0)},addConsumeRecordToDB=async p=>{dbrBWasmDebug&&console.log("%c","color:#0f0",atob(p));await dbrStoreConsumption.setItem(Date.now().toString(),p);dbrNextPostConsumptionTime<Date.now()&&(dbrNextPostConsumptionTime=Date.now()+dbrSessionDuration,sendConsume())},sendConsume=async()=>{dbrPromisePostConsumption=dbrPromisePostConsumption.then(async()=>{var p=Date.now();let d=
await dbrStoreConsumption.keys();if(d.length){dbrBWasmDebug&&console.log("get keys to filter for send: %o",d);var f=[],m=new Map;for(let h of d){let d=JSON.parse(atob(await dbrStoreConsumption.getItem(h))),a;dbrBNewDevice?(dbrBNewDevice=!1,await dbrStoreLicenseInfo.setItem(dbrProductKeys+"old",dbrUUID),a=Math.floor(d.decodeTime/dbrSessionDuration)*dbrSessionDuration):a=Math.ceil(d.decodeTime/dbrSessionDuration)*dbrSessionDuration;dbrBSendSmallRecordsForDebug&&(a=parseInt(d.decodeTime));dbrBWasmDebug&&
console.log("timeKey: %d, dateNow: %d",a,p);if(a>p)continue;f.push(h);let k=m.has(a)?m.get(a):{all:0,oned:0,qr:0,pdf417:0,dm:0,mc:0,other:0};k.all+=d.consumption.all;k.oned+=d.consumption.oned;k.qr+=d.consumption.qr;k.pdf417+=d.consumption.pdf417;k.dm+=d.consumption.dm;k.mc+=d.consumption.mc;k.other+=d.consumption.other;m.set(a,k)}if(f.length){dbrBWasmDebug&&console.log("get keys for send: %o",d);dbrNextPostConsumptionTime=p+dbrSessionDuration;var r=[];m.forEach((d,f)=>{r.push({recordTime:f,consumption:d})});
p={version:"2",runtimeKeys:dbrProductKeys,uuid:dbrUUID,postTime:Date.now(),records:r};dbrBWasmDebug&&dbrBWasmDebug&&console.log(p);await fetch(dbrLicenseServer+"api/verification",{mode:"cors",method:"POST",body:await dbrFuncEncryptAndBtoa(JSON.stringify(p))}).then(async d=>{if(d.ok)for(let d of f)await dbrStoreConsumption.removeItem(d)},d=>{console.error(d)})}}})};
